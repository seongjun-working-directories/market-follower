1. Docker 설치
https://docs.docker.com/desktop/setup/install/windows-install/


2. (Deprecated) 명령프롬프트에서 우분투 이미지 생성 후 자바 설치
- Windows 키 + R → cmd 또는 PowerShell 열기
- 아래 명령어 입력:
  $ docker run -it --name market-follower-ubuntu ubuntu bash
- 이후 우분투가 실행되면 다음의 명령어 입력:
  $ apt update
  $ apt install openjdk-17-jdk -y
  $ java -version


3. Dockerfile 생성
'''
# 1단계: 빌드 스테이지 (Gradle 7.5 + JDK 17 이미지 사용)
FROM gradle:7.5-jdk17 AS build

# 작업 디렉토리를 /app 으로 설정
WORKDIR /app

# Gradle 빌드 스크립트 파일들을 복사
COPY build.gradle settings.gradle ./

# 소스 코드 전체를 복사
COPY src ./src

# Gradle 빌드 실행 (테스트 제외)
RUN gradle clean build -x test

# 2단계: 실행 스테이지 (OpenJDK 17 경량 이미지 사용)
FROM openjdk:17-jdk-slim

# 1단계에서 빌드된 market-follower 프로젝트의 JAR 파일을 복사
COPY --from=build /app/build/libs/*.jar app.jar

# 컨테이너가 시작되면 app.jar 파일을 실행하여 market-follower 애플리케이션 실행
ENTRYPOINT ["java", "-jar", "/app.jar"]
'''


4. AWS EC2에서 실행

$ ssh -i [YOUR_KEY].pem ubuntu@[EC2_PUBLIC_IP]
$ sudo apt update
$ sudo apt install -y docker.io
$ sudo usermod -aG docker $USER
$ newgrp docker


$ sudo apt install -y git
$ git clone https://github.com/your-username/market-follower.git
$ cd market-follower

$ docker build -t market-follower .

# 도커 실행
$ docker run -d -p 8080:8080 --name mf market-follower

# 도커 컨테이너 중지 및 삭제
$ docker rm -f mf

# 도커 상태 확인
$ docker ps -a

# 남아있는 도커 이미지 삭제
$ docker rmi market-follower


5. 깃허브 컨테이너 저장소로 이미지 저장
Dockerfile	    이미지 빌드 방법(환경, 빌드 과정 등) 명세
GHCR	        빌드 완료된 이미지를 저장하고 공유하는 원격 저장소

-> 이를 위해 우선 Access Token을 깃허브에서 발급
   (1) GHCR 사용하려면 Personal Access Token 만들 때
   write:packages, read:packages 권한 꼭 체크
   (2) GitHub Actions가 깃허브에서 이미지 빌드/푸시 하려면
   repo, workflow, packages 권한 포함해야 함

깃허브 컨테이너 저장소로 이미지를 저장하기 위해서는
프로젝트 루트에서 아래의 명령어가 실행된 이후
$ docker build -t market-follower .

다음의 과정을 거쳐야함
# 아이디: 내 깃허브 닉네임 / 비밀번호: 생성한 access token
$ docker login ghcr.io
$ docker tag market-follower ghcr.io/seongjun-working-directories/market-follower
$ docker push ghcr.io/seongjun-working-directories/market-follower

# 이 과정이 끝나면 ghcr.io/seongjun-working-directories/market-follower 여기서 확인 가능
# 이 링크에 들어가면, 무슨 레포지토리에 연결할거냐고 물어보는데 이때, market-follower 라는 스프링부트 프로젝트 레포지토리에 연결

